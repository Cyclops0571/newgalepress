{"version":3,"sources":["galepress-interactivity.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"galepress-interactivity.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////////////////\n// INTERACTIVITY\nvar cInteractivity = new function () {\n    this.objectName = \"interactivity\";\n    var smoothZoomInitialized = false;\n    this.ajaxRequest = function (url, data, funcSuccess, funcError) {\n        updatePageRequestTime();\n        if (typeof funcSuccess === \"undefined\") {\n            funcSuccess = cNotification.success();\n        }\n\n        if (typeof funcError === \"undefined\") {\n            funcError = function (ret) {\n                cNotification.failure(ret.getValue(\"errmsg\"));\n            };\n        }\n\n        $.ajax({\n            type: 'POST',\n            url: url,\n            data: data,\n            success: function (ret) {\n                if (ret.getValue(\"success\") === \"true\") {\n                    funcSuccess(ret);\n                } else {\n                    funcError(ret);\n                }\n            },\n            error: function() {\n                alert('Ajax Request Failed');\n                funcError();\n            }\n        });\n    };\n\n    this.clickOk = function () {\n        var modalEditor = $(\"#modal-editor\");\n        var id = modalEditor.attr(\"opener\");\n        var content = CKEDITOR.instances.editor.getData();\n        $(\"#comp-\" + id + \"-content\").val(content);\n        $(\"#modal-mask\").addClass(\"hide\");\n        modalEditor.addClass(\"hide\").append($('.action'));\n        CKEDITOR.instances.editor.destroy();\n        $('#wrapper').css('position', 'static');\n        $('body').css('overflow', 'auto');\n    };\n\n    this.clickCancel = function () {\n        var modalEditor = $(\"#modal-editor\");\n        $(\"#modal-mask\").addClass(\"hide\");\n        modalEditor.addClass(\"hide\").append($('.action'));\n        CKEDITOR.instances.editor.destroy();\n        $('#wrapper').css('position', 'static');\n        $('body').css('overflow', 'auto');\n    };\n\n    this.openTransferModal = function (e) {\n\n        var componentID = e.parents(\"li:first\").attr(\"componentid\");\n        var pageNo = e.parents(\"li.page:first\").attr(\"pageno\");\n        var transferModal = $('.transfer-modal');\n\n        if (typeof componentID === \"undefined\") {\n            transferModal.find('.one').addClass(\"hide\");\n            transferModal.find('.all').removeClass(\"hide\");\n        } else {\n            transferModal.find('.all').addClass(\"hide\");\n            transferModal.find('.one').removeClass(\"hide\");\n            var componentName = $(\"a[componentid='\" + componentID + \"']\").html();\n            var o = transferModal.find('.one span');\n            var t = o.attr(\"text\");\n            t = t.replace(\"{component}\", componentName);\n            o.html(t);\n        }\n\n        $(\"#transferComponentID\").val(componentID);\n        $(\"#transferFrom\").val(pageNo);\n        transferModal.find('div p strong em').html(pageNo);\n        transferModal.find('select option')\n            .removeAttr(\"disabled\")\n            .eq(parseInt(pageNo) - 1)\n            .attr(\"disabled\", \"disabled\")\n            .next()\n            .prop('selected', true);\n\n        var transferTo = $(\"#transferTo\");\n        if (transferTo.hasClass('chzn-done')) {\n            transferTo.removeClass('chzn-done').next().remove();\n        }\n        transferTo.chosen();\n        transferModal.removeClass(\"hide\");\n        $(\"#modal-mask\").removeClass(\"hide\");\n    };\n\n    this.closeTransferModal = function () {\n\n        $(\".transfer-modal\").addClass(\"hide\");\n        $(\"#modal-mask\").addClass(\"hide\");\n    };\n\n    this.transfer = function () {\n        var contentFileID = $(\"#contentfileid\").val();\n        var componentID = $(\"#transferComponentID\").val();\n        var from = $(\"#transferFrom\").val();\n        var to = $(\"#transferTo\").val();\n        this.saveCurrentPage();\n        cInteractivity.showPage($(\"#pageno\").val());\n\n        var url = '/' + currentLanguage + '/' + route[\"interactivity_transfer\"];\n        var data = \"contentfileid=\" + contentFileID + \"&componentid=\" + componentID + \"&from=\" + from + \"&to=\" + to;\n        var success = function () {\n            cInteractivity.refreshTree();\n            cInteractivity.clearPage();\n            cInteractivity.closeTransferModal();\n        }\n\n        cInteractivity.ajaxRequest(url, data, success, error);\n\n    };\n\n    this.openSettings = function () {\n\n        $(\".compression-settings\").removeClass(\"hide\");\n        $(\"#modal-mask\").removeClass(\"hide\");\n    };\n\n    this.closeSettings = function (dontUpdate) {\n\n        dontUpdate = (typeof dontUpdate == \"undefined\") ? false : dontUpdate;\n\n        if (!dontUpdate) {\n            var compressionSettingsCheckbox = $(\".compression-settings div.checkbox\");\n            compressionSettingsCheckbox.removeClass(\"checked\");\n\n            if ($(\"#included\").val() == \"1\") {\n                compressionSettingsCheckbox.addClass(\"checked\");\n            }\n        }\n\n        $(\".compression-settings\").addClass(\"hide\");\n        $(\"#modal-mask\").addClass(\"hide\");\n    };\n\n    this.saveSettings = function () {\n        var included = $(\"#included\");\n        included.val(0);\n\n        if ($(\".compression-settings div.checkbox\").hasClass(\"checked\")) {\n            included.val(1);\n        }\n\n        this.closeSettings(true);\n    };\n    this.refreshTree = function () {\n        var contentFileID = $(\"#contentfileid\").val();\n        var url = '/' + currentLanguage + '/' + route[\"interactivity_refreshtree\"];\n        var data = \"contentfileid=\" + contentFileID;\n        cInteractivity.ajaxRequest(url, data, function (ret) {\n            //Collapse destroy\n            $('div.tree a').unbind('click');\n            $('#tabs-2').html(ret.getValue(\"html\"));\n            //Collapse init\n            //initTree();\n            $('div.tree').collapse(false, true);\n            $('div.tree a.selectcomponent').click(function () {\n                cInteractivity.selectComponent($(this));\n            });\n        })\n    };\n\n    this.selectComponent = function (obj) {\n        var currentPageNo = $(\"#pageno\").val();\n        var pageNo = obj.parents(\"li.page:first\").attr(\"pageno\");\n\n        if (pageNo !== currentPageNo) {\n            this.saveCurrentPage();\n            this.showPage(pageNo, cInteractivity.selectComponentOnCurrentPage, obj);\n        } else {\n            this.selectComponentOnCurrentPage(obj);\n        }\n    };\n\n    this.selectComponentOnCurrentPage = function (obj) {\n\n        var id = obj.attr(\"componentid\");\n        var tool = $(\"#tool-\" + id);\n        if (!tool.hasClass(\"selected\")) {\n            //hide all other components\n            $('#component-container').find('.component').addClass(\"hide\");\n\n            //show only selected components\n            $('component-container').find('#prop-' + id).removeClass(\"hide\");\n\n            $(\".gselectable\").removeClass(\"selected\");\n            tool.addClass(\"selected\");\n        }\n    };\n\n    this.deleteComponentOnCurrentPage = function () {\n        $(\"#page div.modal-component, #page div.tooltip-trigger\").each(function () {\n            var id = $(this).attr(\"componentid\");\n            $(\"#prop-\" + id + \" div.component-header a.delete\").click();\n        });\n    };\n\n    this.showPage = function (pageno, func, obj) {\n        var pageElm = $(\"#page\");\n        var sliderElm = $(\"div.thumblist ul.slideshow-slides li.each-slide\");\n        var pdfContainer = $(\"#pdf-container\");\n        pdfContainer.addClass(\"loading\");\n        pageElm.css(\"display\", \"none\");\n\n        //remove active class\n        sliderElm.each(function () {\n            $(this).removeClass('active');\n        });\n        //add active class to current page\n        $(\"div.thumblist ul.slideshow-slides li.each-slide a[pageno='\" + pageno + \"']\").parents(\"li:first\").addClass('active');\n\n        var pageCount = sliderElm.length;\n\n        $(\"#pageno\").val(pageno);\n        $(\"#pdf-page\").val(pageno + '/' + pageCount);\n\n        var src = $(\"div.thumblist ul.slideshow-slides li.each-slide a[pageno='\" + pageno + \"'] img\").attr(\"src\");\n\n\n        var img = new Image();\n        img.onload = function () {\n\n            pageElm.css(\"background\", \"url('\" + src + \"') no-repeat top left\")\n                .css(\"width\", img.width + \"px\")\n                .css(\"height\", img.height + \"px\");\n            cInteractivity.clearPage();\n            cInteractivity.loadPage(pageno, func, obj);\n\n            var h = $(window).innerHeight() - pdfContainer.offset().top - $(\"footer\").outerHeight();\n\n\n            if (smoothZoomInitialized) {\n                pageElm.smoothZoom('Reset');\n            } else {\n                smoothZoomInitialized = true;\n                $('#page').smoothZoom({\n                    width: '100%',\n                    height: h + 'px',\n                    responsive: true,\n                    pan_BUTTONS_SHOW: \"NO\",\n                    pan_LIMIT_BOUNDARY: \"NO\",\n                    button_SIZE: 24,\n                    button_ALIGN: \"top right\",\n                    zoom_MAX: 500,\n                    border_TRANSPARENCY: 0,\n                    container: 'pdf-container',\n                    max_WIDTH: '',\n                    max_HEIGHT: '',\n                    animation_SPEED_ZOOM: 0,\n                });\n            }\n        };\n        img.src = src;\n    };\n\n    this.clearPage = function () {\n        var pdfContainer = $(\"#pdf-container\");\n        pdfContainer.find(\".tooltip-trigger\").remove();\n        pdfContainer.find(\".modal-component\").remove();\n\n        $(\"#component-container\").html(\"\");\n    };\n\n    this.loadPage = function (pageno, func, obj) {\n        var frm = $(\"#pagecomponents\");\n        var url = '/' + currentLanguage + '/' + route[\"interactivity_loadpage\"];\n        var data = cForm.serialize(frm);\n        var success = function (ret) {\n            //Sayfa henuz yuklenmeden degistirilirse eski icerikleri gosterme!\n            if (parseInt($(\"#pageno\").val()) !== parseInt(pageno)) {\n                return;\n            }\n\n            $(\"#page\").append(ret.getValue(\"tool\"));\n            $(\"#component-container\").html(ret.getValue(\"prop\"));\n            //Collapse destroy\n            $('div.tree a').unbind('click');\n\n            $(\"#page div.modal-component, #page div.tooltip-trigger\").each(function () {\n\n                var componentName = $(this).attr(\"componentname\");\n                var id = $(this).attr(\"componentid\");\n                var arr = $(this).attr(\"data-position\").split(',');\n                var left = parseInt(arr[0]);\n                var top = parseInt(arr[1]);\n                var width = parseInt($(\"#prop-\" + id + \" input.w\").val());\n                var height = parseInt($(\"#prop-\" + id + \" input.h\").val());\n\n                if (componentName == \"video\" || componentName == \"webcontent\" || componentName == \"slideshow\" || componentName == \"gal360\") {\n                    if ($(this).attr(\"id\") == \"tool-\" + id) {\n                        $(this).component({\n                            left: left,\n                            top: top,\n                            width: width,\n                            height: height\n                        });\n                    }\n                } else {\n                    $(this).component({\n                        left: left,\n                        top: top,\n                        width: width,\n                        height: height\n                    });\n                }\n            });\n\n            $('div.tree').collapse(false, true);\n            $('div.tree a.selectcomponent').click(function () {\n                cInteractivity.selectComponent($(this));\n            });\n\n            $(\"#pdf-container\").removeClass(\"loading\");\n            $(\"#page\").css(\"display\", \"block\");\n\n            if (func && (typeof func == \"function\")) {\n                func(obj);\n            }\n            $('#saveAndExitBtn').show();\n            $('#saveProgressBar').hide();\n            var d = new Date();\n            var h = (d.getHours() > 9 ? \"\" + d.getHours() : \"0\" + d.getHours());\n            var m = (d.getMinutes() > 9 ? \"\" + d.getMinutes() : \"0\" + d.getMinutes());\n            var second = (d.getSeconds() > 9 ? \"\" + d.getSeconds() : \"0\" + d.getSeconds());\n            var s = interactivity[\"autosave\"]\n                .replace(\"{hour}\", h)\n                .replace(\"{minute}\", m)\n                .replace(\"{second}\", second);\n            $(\"#pdf-save span.save-info\").html(s);\n        };\n\n        cInteractivity.ajaxRequest(url, data, success);\n    };\n\n    this.saveCurrentPage = function (successFunction) {\n        //$('#saveAndExitBtn').attr(\"disabled\", true);\n        $(\"#pdf-save span.save-info\").html('');\n        $('#saveAndExitBtn').hide();\n        $('#saveProgressBar').show();\n        var url = '/' + currentLanguage + '/' + route[\"interactivity_save\"];\n        var data = $(\"#pagecomponents\").serialize();\n        var success = successFunction ? successFunction : function () {\n        };\n        cInteractivity.ajaxRequest(url, data, success);\n    };\n\n    this.saveAndClose = function () {\n        $('#closing').val('true');\n        this.saveCurrentPage(function () {\n            cInteractivity.close();\n        });\n    };\n\n    this.close = function () {\n        closeInteractiveIDE();\n    };\n\n    this.exitWithoutSave = function () {\n        this.close();\n    };\n\n    this.hideAllInformation = function () {\n        $(\"div.component-info div\").addClass(\"hide\");\n    };\n\n    this.selectItem = function () {\n        $(\"div.component-info div\").addClass(\"hide\");\n    };\n};"]}